Using backend URL: http://localhost:8001/api
=== MasterX AI Mentor System Backend Focused Tests ===
Testing backend at: http://localhost:8001/api
Running focused tests based on review request:
1. Core API Endpoints
2. Premium AI Features
3. Gamification System
4. Advanced Streaming
5. Edge Cases
==================================================
Created test user: 6851214e1f23bcf96799f517
Verified user exists by email: test_838c24e8-363d-45ec-bdab-a304a1e34ff9@example.com
Created test session: 7f8bd3d5-73c8-45c1-9fe7-31c3c6839fed

=== Testing Health Check Endpoint ===
Root endpoint: {'message': 'MasterX AI Mentor System is running', 'version': '1.0.0', 'status': 'healthy', 'timestamp': '2025-06-17T08:04:10.638873'}
Health endpoint: {'status': 'healthy', 'database': 'healthy', 'ai_service': 'healthy', 'timestamp': '2025-06-17T08:04:10.645289'}
.Created test user: 6851217a1f23bcf96799f51c
Verified user exists by email: test_1d3534ea-21a7-409f-8f5c-d1e5e987d7f3@example.com
Created test session: 34beba30-feaa-4518-b432-3b55ac5c6d65

=== Testing User Management ===
Created user with ID: 685121d81f23bcf96799f522
Retrieved user by email: user_mgmt_b25a1afa-05d0-42ab-b501-2344c6dc678a@example.com
Retrieved user by ID: 66595842-85d1-45fe-b96c-ee1c4b6eeb40
/usr/local/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method MasterXBackendFocusedTests.test_02_user_management of <__main__.MasterXBackendFocusedTests testMethod=test_02_user_management>>)
  return self.run(*args, **kwds)
.Created test user: 685121d81f23bcf96799f523
Verified user exists by email: test_23a696e7-79b3-4bba-b5f4-f9743203f146@example.com
Created test session: b64c29f1-ca8e-4465-9299-67a26695e484

=== Testing Session Management ===

=== Testing User Management ===
Created user with ID: 685121d81f23bcf96799f525
Retrieved user by email: user_mgmt_bd527aab-80e2-4580-a48b-03157a8a07b3@example.com
Retrieved user by ID: bcdf86a0-6890-467d-a976-768e25e134c4
Created session with ID: f26ccbaa-f4da-457a-b509-545b3f43c18b
Retrieved session by ID: f26ccbaa-f4da-457a-b509-545b3f43c18b
Retrieved 1 sessions for user
Ended session: f26ccbaa-f4da-457a-b509-545b3f43c18b
Verified session is inactive: False
/usr/local/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method MasterXBackendFocusedTests.test_03_session_management of <__main__.MasterXBackendFocusedTests testMethod=test_03_session_management>>)
  return self.run(*args, **kwds)
.Created test user: 685121d81f23bcf96799f527
Verified user exists by email: test_30c7c985-5b0f-4810-9756-6cc23876706d@example.com
Created test session: 05dd6661-8a1d-4f82-8e5f-26392ff9210d

=== Testing Basic Chat Functionality ===
Chat response type: premium_adaptive
Chat response length: 7086
Retrieved 2 messages for session
.Created test user: 685121dd1f23bcf96799f52b
Verified user exists by email: test_e96f037c-b628-4601-84d6-ae4adc8b37a9@example.com
Created test session: a767a666-1753-4e76-80d8-3275d22e2b35

=== Testing Premium Chat Endpoints ===
Premium chat (Socratic mode) response type: premium_socratic
Premium chat response length: 1589
Premium chat (Debug mode) response type: premium_debug
.Created test user: 685121f21f23bcf96799f531
Verified user exists by email: test_ea90d52c-9498-41ec-afe6-5a2a47bbac51@example.com
Created test session: 964345cd-5f20-4741-a1cf-5ffdc35a2607

=== Testing Streaming Responses ===
Testing regular streaming endpoint...
Regular stream chunk 1: b'data: {"content": "<think>", "type": "chunk"}'...
Regular stream chunk 2: b'data: {"content": "\\n", "type": "chunk"}'...
Regular stream chunk 3: b'data: {"content": "Okay", "type": "chunk"}'...
Received 5 chunks from regular streaming
Testing premium streaming endpoint...
Premium stream chunk 1: b'data: {"content": "<think>", "type": "chunk", "mode": "adaptive"}'...
Premium stream chunk 2: b'data: {"content": "\\n", "type": "chunk", "mode": "adaptive"}'...
Premium stream chunk 3: b'data: {"content": "Okay", "type": "chunk", "mode": "adaptive"}'...
Received 5 chunks from premium streaming
.Created test user: 685121f61f23bcf96799f53e
Verified user exists by email: test_724df7d3-9d3d-4953-a00b-e4c2df659f81@example.com
Created test session: 361bd38a-37e9-4e3f-b173-0b81e81bdea0

=== Testing Model Management Endpoints ===
Available models: ['deepseek-r1', 'gpt-4o']
Model analytics: {'available_models': ['deepseek-r1', 'gpt-4o'], 'usage_stats': {'deepseek-r1-distill-llama-70b': {'explanation': 14, 'mentor': 3, 'socratic': 3, 'debug': 3, 'challenge': 1}}, 'model_performance': {}, 'total_calls': 24}
.Created test user: 685121f61f23bcf96799f541
Verified user exists by email: test_96c80424-3462-4d07-a101-392be1cba0ba@example.com
Created test session: 5136a091-16a8-4580-8288-1baded7decd1

=== Testing User Analytics Endpoints ===
User analytics: {'user_preferences': {}, 'model_usage': {'available_models': ['deepseek-r1', 'gpt-4o'], 'usage_stats': {'deepseek-r1-distill-llama-70b': {'explanation': 14, 'mentor': 3, 'socratic': 3, 'debug': 3, 'challenge': 1}}, 'model_performance': {}, 'total_calls': 24}, 'session_analytics': {}}
Set user learning mode: {'message': 'Learning mode updated successfully', 'preferred_mode': 'socratic', 'preferences': {'difficulty_preference': 'challenging', 'interaction_style': 'collaborative', 'focus_areas': ['Python', 'Machine Learning']}}
.Created test user: 685121f71f23bcf96799f544
Verified user exists by email: test_ada27751-c458-4d0c-89ad-e081462a397a@example.com
Created test session: 0ee7cf9a-5c80-48d1-b2af-f9cdc7519153

=== Testing User Gamification Status ===
User gamification status: {'streak': {'id': 'b4f5fb0c-b55a-430b-b324-319cda683a52', 'user_id': 'f9de879d-9ff4-4455-b150-46a4e07eaeb7', 'current_streak': 0, 'longest_streak': 0, 'last_activity_date': None, 'freeze_count': 0, 'total_learning_days': 0, 'streak_goals': {}, 'created_at': '2025-06-17T08:06:15.138281', 'updated_at': '2025-06-17T08:06:15.138283'}, 'rewards': {'id': '02d29973-8c63-416e-9300-fe07d24e86ea', 'user_id': 'f9de879d-9ff4-4455-b150-46a4e07eaeb7', 'total_points': 0, 'level': 1, 'experience_points': 0, 'points_to_next_level': 100, 'motivation_profile': {}, 'reward_history': [], 'created_at': '2025-06-17T08:06:15.140889', 'updated_at': '2025-06-17T08:06:15.140891'}, 'achievements': {'unlocked_count': 0, 'total_count': 9, 'details': {'3c01b2fd-a193-4e91-9156-d322f1c4fefb': {'achievement': {'id': '3c01b2fd-a193-4e91-9156-d322f1c4fefb', 'name': 'First Steps', 'description': 'Complete your first learning session', 'icon': 'üéØ', 'category': 'learning', 'requirement_type': 'session_count', 'requirement_value': 1, 'points_reward': 50, 'badge_color': 'green', 'is_premium': False, 'created_at': '2025-06-17T07:56:19.743000'}, 'unlocked': False, 'progress': 100.0}, '352a936d-3a5d-4bec-ac2b-610082ca6830': {'achievement': {'id': '352a936d-3a5d-4bec-ac2b-610082ca6830', 'name': 'Knowledge Seeker', 'description': 'Complete 10 learning sessions', 'icon': 'üìö', 'category': 'learning', 'requirement_type': 'session_count', 'requirement_value': 10, 'points_reward': 200, 'badge_color': 'blue', 'is_premium': False, 'created_at': '2025-06-17T07:56:19.743000'}, 'unlocked': False, 'progress': 10.0}, '8a334717-cb84-4b2f-a6fa-670ae0ad5627': {'achievement': {'id': '8a334717-cb84-4b2f-a6fa-670ae0ad5627', 'name': 'Learning Master', 'description': 'Complete 50 learning sessions', 'icon': 'üèÜ', 'category': 'learning', 'requirement_type': 'session_count', 'requirement_value': 50, 'points_reward': 1000, 'badge_color': 'gold', 'is_premium': True, 'created_at': '2025-06-17T07:56:19.743000'}, 'unlocked': False, 'progress': 2.0}, 'f32d8536-f464-41af-8410-f6bf10e63ab5': {'achievement': {'id': 'f32d8536-f464-41af-8410-f6bf10e63ab5', 'name': 'Consistency Champion', 'description': 'Maintain a 7-day learning streak', 'icon': 'üî•', 'category': 'streak', 'requirement_type': 'streak_days', 'requirement_value': 7, 'points_reward': 300, 'badge_color': 'orange', 'is_premium': False, 'created_at': '2025-06-17T07:56:19.743000'}, 'unlocked': False, 'progress': 0.0}, 'bf0a9822-b3fc-4024-8e21-dea365470a39': {'achievement': {'id': 'bf0a9822-b3fc-4024-8e21-dea365470a39', 'name': 'Dedication Diamond', 'description': 'Maintain a 30-day learning streak', 'icon': 'üíé', 'category': 'streak', 'requirement_type': 'streak_days', 'requirement_value': 30, 'points_reward': 1500, 'badge_color': 'purple', 'is_premium': True, 'created_at': '2025-06-17T07:56:19.743000'}, 'unlocked': False, 'progress': 0.0}, '6254a8c5-621e-497a-aa27-7836df058cb5': {'achievement': {'id': '6254a8c5-621e-497a-aa27-7836df058cb5', 'name': 'Concept Collector', 'description': 'Master 25 concepts across any subject', 'icon': 'üß†', 'category': 'milestone', 'requirement_type': 'concepts_mastered', 'requirement_value': 25, 'points_reward': 500, 'badge_color': 'cyan', 'is_premium': False, 'created_at': '2025-06-17T07:56:19.743000'}, 'unlocked': False, 'progress': 0.0}, 'b42c47a8-5896-4644-bd63-a5f8634d64ce': {'achievement': {'id': 'b42c47a8-5896-4644-bd63-a5f8634d64ce', 'name': 'Expert Explorer', 'description': 'Master 100 concepts across any subject', 'icon': 'üåü', 'category': 'milestone', 'requirement_type': 'concepts_mastered', 'requirement_value': 100, 'points_reward': 2500, 'badge_color': 'gold', 'is_premium': True, 'created_at': '2025-06-17T07:56:19.743000'}, 'unlocked': False, 'progress': 0.0}, '5b82417e-bcec-40b0-9dd1-a3dda5b04993': {'achievement': {'id': '5b82417e-bcec-40b0-9dd1-a3dda5b04993', 'name': 'Team Player', 'description': 'Join your first study group', 'icon': 'üë•', 'category': 'collaboration', 'requirement_type': 'groups_joined', 'requirement_value': 1, 'points_reward': 150, 'badge_color': 'pink', 'is_premium': False, 'created_at': '2025-06-17T07:56:19.743000'}, 'unlocked': False, 'progress': 0.0}, 'de92b008-0f3b-4f11-8683-d07638c41595': {'achievement': {'id': 'de92b008-0f3b-4f11-8683-d07638c41595', 'name': 'Community Builder', 'description': 'Create a study group with 5+ members', 'icon': 'üèóÔ∏è', 'category': 'collaboration', 'requirement_type': 'group_members_recruited', 'requirement_value': 5, 'points_reward': 750, 'badge_color': 'purple', 'is_premium': True, 'created_at': '2025-06-17T07:56:19.743000'}, 'unlocked': False, 'progress': 0.0}}}, 'study_groups': [], 'motivation_profile': {'primary_motivation': 'achiever', 'scores': {'achiever': 0, 'socializer': 0, 'explorer': 0, 'competitor': 0}, 'profile': {'points_multiplier': 1.5, 'prefers': 'achievements'}}, 'next_milestones': [{'achievement': {'id': '3c01b2fd-a193-4e91-9156-d322f1c4fefb', 'name': 'First Steps', 'description': 'Complete your first learning session', 'icon': 'üéØ', 'category': 'learning', 'requirement_type': 'session_count', 'requirement_value': 1, 'points_reward': 50, 'badge_color': 'green', 'is_premium': False, 'created_at': '2025-06-17T07:56:19.743000'}, 'progress': 100.0, 'priority': 'high'}, {'achievement': {'id': '352a936d-3a5d-4bec-ac2b-610082ca6830', 'name': 'Knowledge Seeker', 'description': 'Complete 10 learning sessions', 'icon': 'üìö', 'category': 'learning', 'requirement_type': 'session_count', 'requirement_value': 10, 'points_reward': 200, 'badge_color': 'blue', 'is_premium': False, 'created_at': '2025-06-17T07:56:19.743000'}, 'progress': 10.0, 'priority': 'low'}, {'achievement': {'id': '8a334717-cb84-4b2f-a6fa-670ae0ad5627', 'name': 'Learning Master', 'description': 'Complete 50 learning sessions', 'icon': 'üèÜ', 'category': 'learning', 'requirement_type': 'session_count', 'requirement_value': 50, 'points_reward': 1000, 'badge_color': 'gold', 'is_premium': True, 'created_at': '2025-06-17T07:56:19.743000'}, 'progress': 2.0, 'priority': 'low'}]}
.Created test user: 685121f71f23bcf96799f549
Verified user exists by email: test_d0d81fc4-3934-4382-b557-b339b2a3c0c6@example.com
Created test session: 7561cccf-6fc6-4522-981a-f89ff3e60d11

=== Testing Session Completion Recording ===
Session completion recorded: {'streak': {'streak_broken': False, 'streak_extended': True, 'current_streak': 1, 'freeze_used': False}, 'points': {'points_awarded': 75, 'total_points': 75, 'level': 1, 'level_up': False, 'next_level_progress': 75.0}, 'new_achievements': [{'id': '3c01b2fd-a193-4e91-9156-d322f1c4fefb', 'name': 'First Steps', 'description': 'Complete your first learning session', 'icon': 'üéØ', 'category': 'learning', 'requirement_type': 'session_count', 'requirement_value': 1, 'points_reward': 50, 'badge_color': 'green', 'is_premium': False, 'created_at': '2025-06-17T07:56:19.743000'}], 'motivational_message': "üéØ Great start! You've begun building a learning habit. üèÜ Achievement Unlocked: First Steps!"}
Updated streak: 1
.Created test user: 685121f71f23bcf96799f54f
Verified user exists by email: test_4b12ebcd-5f1d-4296-9f36-a6cb7fd42b55@example.com
Created test session: 25ed84b3-cd02-4cd1-9f08-fafb939b7244

=== Testing Concept Mastery Recording ===
Concept mastery recorded: {'points': {'points_awarded': 55, 'total_points': 55, 'level': 1, 'level_up': False, 'next_level_progress': 55.00000000000001}, 'new_achievements': [{'id': '3c01b2fd-a193-4e91-9156-d322f1c4fefb', 'name': 'First Steps', 'description': 'Complete your first learning session', 'icon': 'üéØ', 'category': 'learning', 'requirement_type': 'session_count', 'requirement_value': 1, 'points_reward': 50, 'badge_color': 'green', 'is_premium': False, 'created_at': '2025-06-17T07:56:19.743000'}]}
.Created test user: 685121f71f23bcf96799f555
Verified user exists by email: test_7e6c281e-0e55-4041-817c-e3395cd3ca0b@example.com
Created test session: c093b77f-6c1f-4ae5-ba6d-e55e11f05113

=== Testing Achievements System ===
Retrieved 9 achievements
First achievement: First Steps - Complete your first learning session
.Created test user: 685121f71f23bcf96799f559
Verified user exists by email: test_54f7b107-1bb9-4b02-8684-21c48bb44f38@example.com
Created test session: 1a8135c9-13e2-42c0-a484-defa28939885

=== Testing Study Groups ===
Created study group: AI-Guided Python Programming Study Group with ID: aa3c0b0d-bf03-4b9b-9358-0f8f6d455dc5
Retrieved 1 study groups
Retrieved 2 public study groups
/usr/local/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method MasterXBackendFocusedTests.test_13_study_groups of <__main__.MasterXBackendFocusedTests testMethod=test_13_study_groups>>)
  return self.run(*args, **kwds)
.Created test user: 685121f71f23bcf96799f560
Verified user exists by email: test_4ce701c4-ed1e-45a8-9378-ae4a4a4e1235@example.com
Created test session: ae26f79d-8061-4e5a-be5b-4e1f255b4a2c

=== Testing Advanced Streaming Features ===
Created streaming session: 9a04ebb5-b677-4e05-87f7-e519d7b74d88
Testing advanced streaming chat...
Advanced stream chunk 1: b'data: {"content": "Neural networks learn through a process called backpropagation. ", "type": "chunk'...
Advanced stream chunk 2: b'data: {"content": "This involves calculating gradients and adjusting weights. ", "type": "chunk", "m'...
Advanced stream chunk 3: b'data: {"content": "The network makes predictions, compares them to actual values, ", "type": "chunk"'...
Received 5 chunks from advanced streaming
Stream interruption result: {'error': 'No active stream to interrupt'}
Multi-branch response generated with 4 branches
Recommended branch: visual
Streaming analytics: {'total_streaming_sessions': 1, 'average_reading_speed_wpm': 250.0, 'preference_patterns': {'reading_speed_preference': {'fast': 1}, 'interrupt_enabled': {'True': 1}, 'multi_branch_mode': {'True': 1}, 'fact_check_enabled': {'True': 1}}, 'adaptive_recommendations': {'optimal_speed': 'fast', 'suggest_interrupts': False, 'recommend_multi_branch': False}}
.Created test user: 685122981f23bcf96799f567
Verified user exists by email: test_afbd5749-1b45-40a1-ba25-c775b63e4df5@example.com
Created test session: 395f0b1b-b827-40ec-a382-22e25fb483de

=== Testing Edge Cases and Error Handling ===
Invalid user ID response: 404 - {"detail":"User not found"}
Invalid session ID response: 404 - {"detail":"Session not found"}
Missing parameters response: 422 - {"detail":[{"type":"missing","loc":["body","session_id"],"msg":"Field required","input":{"user_message":"What is Python?"},"url":"https://errors.pydantic.dev/2.11/v/missing"}]}
Duplicate user response: 400 - {"detail":"User with this email already exists"}
.
----------------------------------------------------------------------
Ran 15 tests in 334.744s

OK

==================================================
Tests completed!
==================================================

Using backend URL: http://localhost:8001/api
=== MasterX AI Mentor System Backend Tests ===
Testing backend at: http://localhost:8001/api
Running tests focused on gamification and advanced streaming features:
1. Gamification Endpoints (Achievements, Streaks, Study Groups)
2. Advanced Streaming Endpoints (Adaptive Streaming, Interruptions, Multi-branch)
3. Integration Flow (User Creation to Achievement Unlocking)
==================================================
Created test user: 685120de1f23bcf96799f4ea
Verified user exists by email: test_2dad39c9-c556-481b-b3dd-667fbc3e9457@example.com
Created test session: aedbf77b-8d7b-49de-aec9-19f6898d34de

=== Testing Health Check Endpoint ===
Root endpoint: {'message': 'MasterX AI Mentor System is running', 'version': '1.0.0', 'status': 'healthy', 'timestamp': '2025-06-17T08:01:34.048519'}
Health endpoint: {'status': 'healthy', 'database': 'healthy', 'ai_service': 'healthy', 'timestamp': '2025-06-17T08:01:34.056198'}
AI service status: healthy
.Created test user: 685120de1f23bcf96799f4ec
Verified user exists by email: test_b01b7684-3d2c-4378-a3d5-3e7a0bd3bd83@example.com
Created test session: 7d47c78f-4dd9-4241-a823-0d435ac53b77

=== Testing User Creation Flow ===
Created user with ID: 685120de1f23bcf96799f4ee
Using workaround: Getting user by email instead of ID
Successfully retrieved user by email: user_flow_19ec06f4-6971-48a7-8c42-a1d26393b877@example.com
/usr/local/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method MasterXBackendTests.test_02_user_creation_flow of <__main__.MasterXBackendTests testMethod=test_02_user_creation_flow>>)
  return self.run(*args, **kwds)
.Created test user: 685120de1f23bcf96799f4ef
Verified user exists by email: test_9d33b69a-2c63-472a-b986-8c564c9ce195@example.com
Created test session: 25e833b7-58b3-4dae-9773-032333da46d9

=== Testing Session Creation Flow ===

=== Testing User Creation Flow ===
Created user with ID: 685120de1f23bcf96799f4f1
Using workaround: Getting user by email instead of ID
Successfully retrieved user by email: user_flow_251a0c64-65d8-45ec-94e4-8d41589582de@example.com
Created session with ID: 1b19b1b5-04a0-46db-92ef-e3688f28afe4 for user: 755311eb-8907-4075-bf6a-84e4798e797e
Successfully retrieved session by ID: 1b19b1b5-04a0-46db-92ef-e3688f28afe4
/usr/local/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method MasterXBackendTests.test_03_session_creation_flow of <__main__.MasterXBackendTests testMethod=test_03_session_creation_flow>>)
  return self.run(*args, **kwds)
.Created test user: 685120de1f23bcf96799f4f3
Verified user exists by email: test_cf3bcd20-2d65-49d3-99b3-e7bce2cf2e66@example.com
Created test session: e6588387-70bc-431b-8ce4-5d7d34e3d32d

=== Testing Complete Onboarding Integration ===
Step 1: Creating user with experience level...
User created successfully with ID: 685120de1f23bcf96799f4f5
Getting user by email to ensure correct ID...
Retrieved user by email with ID: ef305580-fbf4-467d-b7e8-ebd3e6cfdcca
Step 2: Creating session with user ID...
Session created successfully with ID: c08203ad-7501-42cb-b0e4-1accc380fa73
Step 3: Verifying user sessions endpoint...
Found 1 sessions for user
Step 4: Testing initial chat message...
Initial chat message successful, response length: 5204
Complete onboarding flow test PASSED!
/usr/local/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method MasterXBackendTests.test_04_onboarding_integration of <__main__.MasterXBackendTests testMethod=test_04_onboarding_integration>>)
  return self.run(*args, **kwds)
.Created test user: 685120e31f23bcf96799f4f9
Verified user exists by email: test_74e9a9f8-4b1d-434f-9def-e7c07e6c327a@example.com
Created test session: f85d5ac4-d056-4c56-9e33-da4fa66f63e7

=== Testing Real-time Streaming Chat with DeepSeek R1 ===

=== Testing Complete Onboarding Integration ===
Step 1: Creating user with experience level...
User created successfully with ID: 685120e31f23bcf96799f4fb
Getting user by email to ensure correct ID...
Retrieved user by email with ID: 84a2cfc0-8080-4505-9131-ac597e01845f
Step 2: Creating session with user ID...
Session created successfully with ID: ad470c13-b527-43af-90ec-bcceccd1385d
Step 3: Verifying user sessions endpoint...
Found 1 sessions for user
Step 4: Testing initial chat message...
Initial chat message successful, response length: 5427
Complete onboarding flow test PASSED!
Sending streaming request to /api/chat/stream...
Reading streaming response chunks...
Streaming chat: Received 20 total chunks, 20 content chunks
Complete signal received: False
Content sample: <think>
Alright...
DeepSeek content detected: False
Session messages: Found 3 messages after streaming
.Created test user: 685121061f23bcf96799f500
Verified user exists by email: test_c029fbc6-1c19-45af-8ae1-a59cc13cbf40@example.com
Created test session: 7b63ee06-7bc1-4f5d-b4fa-f26a811445ca

=== Testing AI Service Integration with Premium Features ===
Created user for AI service test: 685121061f23bcf96799f502
Getting user by email to ensure correct ID...
Retrieved user by email with ID: 4762035c-2602-4a4c-bc82-2ffe52ebdb78
Created session for AI service test: e2f64a27-76f7-4a9e-a7c7-c1344220eb3e
Sending request to /api/chat...
FCreated test user: 6851210c1f23bcf96799f506
Verified user exists by email: test_4e41aee3-316b-4e95-9aa6-0b3b6c4a4d71@example.com
Created test session: ea8df12f-d378-4888-b7ca-0a0bab6bbbc7

=== Testing Premium Learning Features ===

Testing exercise generation...
Exercise question: <think>
Okay, so I'm trying to answer this multiple-choice question about neural networks in medical...
Premium exercise features present: 4/9
Features found: explanation, concepts, difficulty_score, pro_tips

Testing exercise analysis...
FCreated test user: 6851210f1f23bcf96799f508
Verified user exists by email: test_2943fa4e-4fd8-42c0-ac21-ceee4bd2659a@example.com
Created test session: 6af2811c-9fbb-4c62-93af-618ab6299d20

=== Testing Groq API Integration with DeepSeek R1 70B ===
Testing direct API call to Groq with model: deepseek-r1-distill-llama-70b
API Response: <think>
Okay, so I need to explain deep learning in three sentences. Hmm, I remember that deep learning is a part of machine learning, but I'm not exa...
Direct Groq API test PASSED!
/usr/local/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method MasterXBackendTests.test_08_groq_api_integration of <__main__.MasterXBackendTests testMethod=test_08_groq_api_integration>>)
  return self.run(*args, **kwds)
.Created test user: 685121111f23bcf96799f50a
Verified user exists by email: test_eb4d3ab5-cb3a-487f-8e7d-ac1644b2cbe5@example.com
Created test session: 692fe552-8f8d-49bc-8a83-8e20fd315706

=== Testing All Required API Endpoints ===

1. Testing /api/health endpoint...
Health check: {'status': 'healthy', 'database': 'healthy', 'ai_service': 'healthy', 'timestamp': '2025-06-17T08:02:25.082381'}

2. Testing POST /api/users endpoint...
Created user with ID: 685121111f23bcf96799f50c

3. Testing GET /api/users/email/{email} endpoint...
Retrieved user by email: comprehensive_5bd93f63-1cd8-499b-b150-35fe85333afd@example.com

4. Testing POST /api/sessions endpoint...
Created session with ID: e5600c9c-33b4-41a0-bc5d-57a9f14102be

5. Testing GET /api/users/{user_id}/sessions endpoint...
Retrieved 1 sessions for user

6. Testing POST /api/chat/stream endpoint...
Stream chunk 1: b'data: {"content": "<think>", "type": "chunk"}'...
Stream chunk 2: b'data: {"content": "\\n", "type": "chunk"}'...
Stream chunk 3: b'data: {"content": "Okay", "type": "chunk"}'...
Received 5 streaming chunks

7. Testing POST /api/chat endpoint...
Chat response length: 6589

8. Testing POST /api/exercises/generate endpoint...
Generated exercise question: <think>
Alright, so I have this Python question to solve. It's about a function that reads data from...

9. Testing POST /api/learning-paths/generate endpoint...
Generated learning path with title: Premium Data Science Learning Journey

10. Testing GET /api/sessions/{session_id}/messages endpoint...
Retrieved 3 messages for session

11. Testing PUT /api/sessions/{session_id}/end endpoint...
Successfully ended session
Verified session is now inactive

All API endpoints tested successfully!
/usr/local/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method MasterXBackendTests.test_09_comprehensive_api_endpoints of <__main__.MasterXBackendTests testMethod=test_09_comprehensive_api_endpoints>>)
  return self.run(*args, **kwds)
.Created test user: 685121381f23bcf96799f511
Verified user exists by email: test_e593fa01-c0e2-49f5-8981-b9068a9f94c1@example.com
Created test session: b7931032-ba8e-431f-96aa-90f8b0598884

=== Testing Premium Chat Endpoints with Learning Modes ===
Created user for premium chat test: 016cc0e2-be55-4d31-b45b-b6b8a615858e
Created session for premium chat test: efa6c8e2-e5ea-4d07-afe6-561fb3cb7f34

Testing premium chat with Socratic mode...
Socratic mode response type: premium_socratic
Socratic response sample: <think>
Okay, so I'm trying to figure out what machine learning is. I've heard the term a lot, especially in the context of AI and technology, but I'm...
Response contains questions: True

Testing premium chat with Debug mode...
Debug mode response type: premium_debug
Debug response sample: <think>
Okay, so the user mentioned they're confused about neural networks. Let me try to figure out where they might be getting stuck. Maybe they hav...
Response contains debug content: True

Testing premium chat with Challenge mode...
Challenge mode response type: premium_challenge
Challenge response sample: <think>
Okay, so the user has asked for a programming challenge again. Let me see what the history shows. They previously asked about machine learning...
Response contains challenge content: True

Testing premium chat with Mentor mode...
Mentor mode response type: premium_mentor
Mentor response sample: <think>
Alright, so I'm trying to figure out how to advance my career in AI. I'm just starting out, so I'm not entirely sure where to begin. I've hear...
Response contains mentor content: True

Testing premium streaming chat...
Premium streaming: Received 20 total chunks, 20 content chunks
Complete signal received: False
Learning mode in stream: adaptive
Premium chat endpoints test completed successfully!
/usr/local/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method MasterXBackendTests.test_10_premium_chat_endpoints of <__main__.MasterXBackendTests testMethod=test_10_premium_chat_endpoints>>)
  return self.run(*args, **kwds)
.Created test user: 685121f61f23bcf96799f534
Verified user exists by email: test_a0d3dd87-58ae-4217-a8ae-1984d77771bd@example.com
Created test session: dcf3a795-259b-4b3a-8f04-7b926082c6f6

=== Testing Model Management Endpoints ===

Testing GET /api/models/available endpoint...
Available models: ['deepseek-r1']
DeepSeek R1 capabilities: {'provider': 'groq', 'specialties': ['reasoning', 'learning', 'explanation', 'socratic', 'debug'], 'strength_score': 9, 'available': True}

Testing POST /api/models/add-key endpoint with dummy data...
Add key response: {'success': True, 'available_models': ['deepseek-r1', 'gpt-4o'], 'message': 'Successfully added openai models'}

Testing GET /api/analytics/models endpoint...
Model analytics: {'available_models': ['deepseek-r1', 'gpt-4o'], 'usage_stats': {'deepseek-r1-distill-llama-70b': {'explanation': 13, 'mentor': 3, 'socratic': 3, 'debug': 3, 'challenge': 1}}, 'model_performance': {}, 'total_calls': 23}
Model management endpoints test completed successfully!
.Created test user: 685121f61f23bcf96799f536
Verified user exists by email: test_2e1343bd-7df8-4c60-9536-9a0f5f54a59f@example.com
Created test session: eefab3f5-9ba6-4351-9b3c-af1ae3daf01b

=== Testing User Learning Preferences Endpoints ===
Created user for learning preferences test: 220da4e6-5d8c-4cb3-a876-e25458ca8038

Testing POST /api/users/{user_id}/learning-mode endpoint...
Set learning mode response: {'message': 'Learning mode updated successfully', 'preferred_mode': 'socratic', 'preferences': {'difficulty_preference': 'challenging', 'interaction_style': 'collaborative', 'cost_effective': True, 'focus_areas': ['Deep Learning', 'Neural Networks']}}

Testing GET /api/users/{user_id}/analytics endpoint...
User learning analytics: {'user_preferences': {'preferred_mode': 'socratic', 'cost_effective': True, 'difficulty_preference': 'challenging', 'interaction_style': 'collaborative', 'focus_areas': ['Deep Learning', 'Neural Networks']}, 'model_usage': {'available_models': ['deepseek-r1', 'gpt-4o'], 'usage_stats': {'deepseek-r1-distill-llama-70b': {'explanation': 14, 'mentor': 3, 'socratic': 3, 'debug': 3, 'challenge': 1}}, 'model_performance': {}, 'total_calls': 24}, 'session_analytics': {}}
User learning preferences endpoints test completed successfully!
.Created test user: 685121f61f23bcf96799f53a
Verified user exists by email: test_961fb34f-8159-4a11-b3d6-199ea51fac9f@example.com
Created test session: b50a65d8-2d0a-4097-a0e1-adf9bd46a207

=== Testing Gamification Endpoints ===
Created user for gamification test: 68bc8ee1-939c-4fc9-9b50-42518cf14ece
Created session for gamification test: 75aa0304-206e-48ca-aec7-97c859940303

1. Testing GET /api/achievements endpoint...
Found 9 achievements
First achievement: First Steps - Complete your first learning session

2. Testing GET /api/users/{user_id}/gamification endpoint...
Gamification status: Level 1, Streak: 0
Motivation profile: achiever

3. Testing POST /api/users/{user_id}/gamification/session-complete endpoint...
Session completion: Streak 1, Points awarded: 75
Motivational message: üéØ Great start! You've begun building a learning habit. üèÜ Achievement Unlocked: First Steps!

4. Testing POST /api/users/{user_id}/gamification/concept-mastered endpoint...
Concept mastery: Points awarded: 55
New achievements: 0

5. Testing POST /api/study-groups endpoint...
Created study group: AI-Guided Python Programming Study Group with ID: 20203d2f-bbb6-4d5f-aee6-5f4ec2221462

6. Testing GET /api/study-groups endpoint...
Retrieved 1 study groups for user

Checking updated gamification status...
Updated gamification status: Level 2, Total points: 304
Gamification endpoints test completed successfully!
/usr/local/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method MasterXBackendTests.test_13_gamification_endpoints of <__main__.MasterXBackendTests testMethod=test_13_gamification_endpoints>>)
  return self.run(*args, **kwds)
.Created test user: 685121f71f23bcf96799f554
Verified user exists by email: test_e46be1e4-86a3-4de4-a3b9-61a9819ee00d@example.com
Created test session: 35cc3426-1762-4d29-875d-c50db2c0daf5

=== Testing Advanced Streaming Endpoints ===

=== Testing Gamification Endpoints ===
Created user for gamification test: 6cbaf3e5-337d-4464-abd9-71c702bba4ff
Created session for gamification test: 8c71c44b-291a-4687-8810-055b28bce53b

1. Testing GET /api/achievements endpoint...
Found 9 achievements
First achievement: First Steps - Complete your first learning session

2. Testing GET /api/users/{user_id}/gamification endpoint...
Gamification status: Level 1, Streak: 0
Motivation profile: achiever

3. Testing POST /api/users/{user_id}/gamification/session-complete endpoint...
Session completion: Streak 1, Points awarded: 75
Motivational message: üéØ Great start! You've begun building a learning habit. üèÜ Achievement Unlocked: First Steps!

4. Testing POST /api/users/{user_id}/gamification/concept-mastered endpoint...
Concept mastery: Points awarded: 55
New achievements: 0

5. Testing POST /api/study-groups endpoint...
Created study group: AI-Guided Python Programming Study Group with ID: bb09dfd5-3a5f-4699-8ef0-b5df4effbdfe

6. Testing GET /api/study-groups endpoint...
Retrieved 1 study groups for user

Checking updated gamification status...
Updated gamification status: Level 2, Total points: 304
Gamification endpoints test completed successfully!
Using existing user ID: 6cbaf3e5-337d-4464-abd9-71c702bba4ff
Created session for advanced streaming test: 8c4c19f9-221b-44b9-9393-bf9a57ce549c

1. Testing POST /api/streaming/session endpoint...
Created streaming session with ID: 7bd51c0e-5467-475f-baa5-f096de022071
Streaming preferences: Speed 250 WPM, Reading speed: fast

2. Testing POST /api/streaming/{session_id}/chat endpoint...
Reading streaming response chunks...
Advanced streaming: Received 5 total chunks, 4 content chunks
Complete signal received: True
Metadata included: True

3. Testing POST /api/streaming/{session_id}/interrupt endpoint...
Interruption test note: No active stream to interrupt (This is expected if no active stream)

4. Testing POST /api/streaming/multi-branch endpoint...
Multi-branch response generated with 4 branches
Recommended branch: visual

5. Testing GET /api/streaming/{user_id}/analytics endpoint...
Streaming analytics: 1 sessions
Average reading speed: 250.0 WPM
Adaptive recommendations: {'optimal_speed': 'fast', 'suggest_interrupts': False, 'recommend_multi_branch': False}
Advanced streaming endpoints test completed successfully!
.Created test user: 685122981f23bcf96799f568
Verified user exists by email: test_a0aae1c5-781f-4eb7-869e-e40b05314b0d@example.com
Created test session: 5d4c5df9-2af3-41a2-84d2-a26c5fbf0773

=== Testing Complete Gamification Integration Flow ===

Step 1: Creating user...
Created user with ID: 8b5aee05-5751-4426-b219-9718cfbdbaba

Step 2: Creating session...
Created session with ID: 4aa0bca3-94e5-42c0-82a5-c83b3a0b6612

Step 3: Checking initial gamification status...
Initial status: Streak 0, Points 0, Achievements 0

Step 4: Completing a learning session...
Session completed: üéØ Great start! You've begun building a learning habit. üèÜ Achievement Unlocked: First Steps!

Step 5: Mastering a concept...
Concept mastered: Points awarded 55

Step 6: Creating a study group...
Created study group: AI-Guided Python Programming Study Group

Step 7: Checking final gamification status...
Final status: Streak 1, Points 304, Achievements 1

Gamification integration flow test completed successfully!
Progress: Streak +1, Points +304, Achievements +1
.
======================================================================
FAIL: test_06_ai_service_integration (__main__.MasterXBackendTests.test_06_ai_service_integration)
Test AI service integration with premium response formatting
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/backend_test.py", line 403, in test_06_ai_service_integration
    self.assertIn("complexity_score", metadata)
AssertionError: 'complexity_score' not found in {'learning_mode': 'adaptive', 'task_type': 'explanation', 'model_used': 'premium_multi_model', 'session_id': 'e2f64a27-76f7-4a9e-a7c7-c1344220eb3e', 'timestamp': '2025-06-17T08:02:20.510332', 'premium_features': {'adaptive_difficulty': True, 'personalized_content': True, 'multi_modal_support': True, 'analytics_enabled': True}}

======================================================================
FAIL: test_07_premium_learning_features (__main__.MasterXBackendTests.test_07_premium_learning_features)
Test premium learning features including exercise generation and learning paths
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/app/backend_test.py", line 470, in test_07_premium_learning_features
    self.assertEqual(response.status_code, 200)
AssertionError: 422 != 200

----------------------------------------------------------------------
Ran 15 tests in 452.748s

FAILED (failures=2)

==================================================
Tests completed!
==================================================
